/* etm2p2c.f -- translated by f2c (version 19961017).
   You must link the resulting object file with the libraries:
	-lf2c -lm   (in that order)
*/

#include "f2c.h"
#include "../mex/of_def.h"

/* Subroutine */ int etm2p2c_(coor, car, iopt, ae)
doublereal *coor, *car;
int32 *iopt;
doublereal *ae;
{
    /* Initialized data */

    static int32 ijt[12] = { 1,3,5,7,9,11,2,4,6,8,10,12 };
    static struct {
	doublereal e_1[126];
	} equiv_2 = { .0071428571428571428, -7.9365079365079365e-4, -7.9365079365079365e-4, .0047619047619047619, .0015873015873015873, .0047619047619047619, -7.9365079365079365e-4, -7.9365079365079365e-4, 3.9682539682539682e-4, -.0015873015873015873, 0., 0., -7.9365079365079365e-4, .0071428571428571428, -7.9365079365079365e-4, .0047619047619047619, .0047619047619047619, .0015873015873015873, -7.9365079365079365e-4, 3.9682539682539682e-4, -7.9365079365079365e-4, 0., 0., -.0015873015873015873, 
		3.9682539682539682e-4, -7.9365079365079365e-4, -7.9365079365079365e-4, 0., -.0015873015873015873, 0., -7.9365079365079365e-4, -7.9365079365079365e-4, .0071428571428571428, .0015873015873015873, .0047619047619047619, .0047619047619047619, .0047619047619047619, -.0015873015873015873, 0., 0., -.0031746031746031746, 0., -.0015873015873015873, .0047619047619047619, 0., 0., 0., -.0031746031746031772, 0., 0., .0015873015873015873, -.0063492063492063492, -.0031746031746031746, 
		-.0031746031746031746, 0., 0., -.0063492063492063492, .057142857142857142, .019047619047619047, .019047619047619047, .0015873015873015873, 0., 0., -.0031746031746031746, -.0063492063492063492, -.0031746031746031746, 0., .0047619047619047619, -.0015873015873015873, 0., 0., -.0031746031746031746, 0., -.0015873015873015873, .0047619047619047619, -.0031746031746031746, 0., 0., -.0031746031746031772, 0., -.0031746031746031746, .019047619047619047, .019047619047619047, 
		.012698412698412698, -.0063492063492063492, 0., 0., .019047619047619047, .057142857142857142, .019047619047619047, .0047619047619047619, 0., -.0015873015873015873, 0., -.0031746031746031798, 0., 0., .0015873015873, 0., -.0031746031746031746, -.0031746031746031746, -.0063492063492063492, -.0015873015873015873, 0., .0047619047619047619, -.0031746031746031746, 0., 0., 0., -.0031746031746031746, -.0031746031746031746, .019047619047619047, .012698412698412698, .019047619047619047, 
		-.0031746031746031746, -.0031746031746031746, 0., .012698412698412698, .019047619047619047, .019047619047619047, 0., -.0063492063492063492, 0., .019047619047619047, .019047619047619047, .057142857142857142 };


    /* System generated locals */
    int32 i__1;

    /* Local variables */
    static int32 idec, jdec, ifin, iint;
#define c__ ((doublereal *)&equiv_2)
    static int32 i__, j, ibloc;
    static doublereal delta[6];
#define c1 ((doublereal *)&equiv_2)
#define c2 ((doublereal *)&equiv_2 + 42)
#define c3 ((doublereal *)&equiv_2 + 84)
    static int32 i1, j1, ii, kk;
    static doublereal x21, y21, x31, y31, x32, y32, x41, y41, x42, y42, x54, y54, x61, y61, x63, y63, x65, y65, rho;

/* *************************************************************** */
/* BUT : MATRICE DE MASSE DE L ELEMENT Membrane: TRIA AP2C */
/* --- */
/* in : coor(noe,ndim) : coor. 3 sommets + 3 milieux aretes */
/*      car            : caracteristiques des materiaux */
/*                       car(1) = rho masse volumique */
/*      iopt           : ouvert si masse lumping ou autre ds futur */

/* out: ae(78)         : matrice triangulaire sup */

/* programmeur : modulef */
/* ............................................................... */
    /* Parameter adjustments */
    --ae;
    --car;
    coor -= 7;

    /* Function Body */

    x21 = coor[8] - coor[7];
    y21 = coor[14] - coor[13];
    x31 = coor[9] - coor[7];
    y31 = coor[15] - coor[13];
    x32 = coor[9] - coor[8];
    y32 = coor[15] - coor[14];
    x41 = coor[10] - coor[7];
    y41 = coor[16] - coor[13];
    x42 = coor[10] - coor[8];
    y42 = coor[16] - coor[14];
    x54 = coor[11] - coor[10];
    y54 = coor[17] - coor[16];
    x61 = coor[12] - coor[7];
    y61 = coor[18] - coor[13];
    x63 = coor[12] - coor[9];
    y63 = coor[18] - coor[15];
    x65 = coor[12] - coor[11];
    y65 = coor[18] - coor[17];

/*    -----   CALCUL DE DELTA AUX 6 NOEUDS  ----- */

    delta[0] = (x41 * 3. + x42) * (y61 * 3. + y63) - (x61 * 3. + x63) * (y41 * 3. + y42);
    delta[1] = (x42 * 3. + x41) * (y54 * -4. + y31) + (x54 * 4. - x31) * (y42 * 3. + y41);
    delta[2] = (x65 * 4. + x21) * (y63 * 3. + y61) - (x63 * 3. + x61) * (y65 * 4. + y21);
    delta[3] = x21 * (y54 * 2. + y61 + y63) - y21 * (x54 * 2. + x61 + x63);
    delta[4] = -(x65 * 2. + x41 + x42) * (y54 * 2. - y61 - y63) + (y65 * 2. + y41 + y42) * (x54 * 2. - x61 - x63);
    delta[5] = y31 * (x65 * -2. + x41 + x42) + x31 * (y65 * 2. - y41 - y42);

    rho = car[1];
    for (j = 1; j <= 6; ++j) {
	delta[j - 1] *= rho;
/* L5: */
    }

/*    -----   CALCUL DE AE(.)  ----- */

    for (j = 1; j <= 78; ++j) {
	ae[j] = 0.;
/* L6: */
    }

    idec = 0;
    jdec = 0;
    for (ibloc = 1; ibloc <= 2; ++ibloc) {
	for (j = 1; j <= 6; ++j) {
	    ifin = j;
	    i__1 = ifin;
	    for (i__ = 1; i__ <= i__1; ++i__) {
		i1 = idec + i__;
		j1 = jdec + j;
		if (ijt[i1 - 1] > ijt[j1 - 1]) {
		    goto L7;
		}
		kk = ijt[j1 - 1] * (ijt[j1 - 1] - 1) / 2 + ijt[i1 - 1];
		goto L8;
L7:
		kk = ijt[i1 - 1] * (ijt[i1 - 1] - 1) / 2 + ijt[j1 - 1];
L8:
		ii = j * (j - 1) / 2 + i__;
		for (iint = 1; iint <= 6; ++iint) {
		    ae[kk] += c__[iint + ii * 6 - 7] * delta[iint - 1];
/* L9: */
		}
/* L10: */
	    }
	}
	idec = 6;
	jdec = 6;
/* L11: */
    }
} /* etm2p2c_ */

#undef c3
#undef c2
#undef c1
#undef c__


